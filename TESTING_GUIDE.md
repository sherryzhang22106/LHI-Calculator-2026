# LHI Calculator v2.0 测试指南

## 🎯 新功能概览

### 1. DeepSeek AI 分析
- 每次提交评估自动调用 DeepSeek API
- 生成 5 个维度的专业心理分析
- 温暖、专业、易懂的中文分析报告

### 2. 加载动画
- 提交评估时显示"正在分析中..."加载状态
- 旋转动画提示用户等待
- 避免用户误以为系统无响应

### 3. 分享功能
- 生成唯一分享链接
- 一键复制链接
- 访客可查看简化版分析报告
- CTA 引导访客开始测评

---

## 🧪 完整测试流程

### 步骤 1: 访问首页
```
URL: http://localhost:3001/
```

### 步骤 2: 输入测试兑换码
可用的测试码：
- `LHITEST04`
- `LHITEST05`

**注意**: `LHI12345` 已被使用，无法再次使用

### 步骤 3: 完成问卷
- 总共 40 道题目
- 分 6 个维度展示
- 每题必答才能进入下一页

### 步骤 4: 提交评估
- 点击"💖 提交评估"
- 应该看到按钮变为"正在分析中..."
- 旋转加载动画
- 等待 3-10 秒（DeepSeek API 调用时间）

### 步骤 5: 查看 AI 分析报告
报告应该包含以下部分：

#### ✅ 顶部分数展示
- 大号的健康指数分数
- 健康等级标签
- 进度条

#### ✅ AI 专业分析（5个维度）
1. **📊 结果解释** (粉色卡片)
   - 总体得分和依恋风格解读
   
2. **✨ 你的优势** (绿色渐变卡片)
   - 健康维度和积极方面
   
3. **⚠️ 需要注意的方面** (橙色渐变卡片)
   - 需改善的维度和潜在风险
   
4. **💝 个性化建议** (蓝色渐变卡片)
   - 根据具体维度的针对性建议
   
5. **🎯 专业建议** (紫色渐变卡片)
   - 改善方向和行动建议

#### ✅ 技术详情
- 雷达图
- 依恋风格分析
- 各维度健康详情

#### ✅ 操作按钮
- ↻ 重新测试
- 📤 分享结果

### 步骤 6: 测试分享功能
1. 点击"📤 分享结果"按钮
2. 应该弹出分享弹窗
3. 显示分享链接（格式：`http://localhost:3001/share/{uuid}`）
4. 点击"复制链接"按钮
5. 按钮文字变为"✓ 已复制"
6. 复制链接到新标签页打开

### 步骤 7: 查看分享页面
- 应该看到简化版的分析报告
- 顶部有"朋友分享的恋爱健康指数报告"横幅
- 显示分数和依恋风格
- 显示简化的 AI 分析（结果解释和优势）
- 底部有 CTA："想了解你自己的恋爱健康指数吗？"
- 点击"🚀 立即开始测评"应该跳转到首页

---

## 🐛 故障排查

### 问题 1: 提交后长时间无响应
**原因**: 兑换码已被使用  
**解决**: 使用新的测试码 `LHITEST04` 或 `LHITEST05`

### 问题 2: 报告页面没有显示 AI 分析
**检查步骤**:
1. 打开浏览器控制台 (F12)
2. 查看 Console 日志，应该有：
   ```
   Report result: {...}
   AI Analysis: {...}
   ```
3. 检查 AI Analysis 是否为 null

**可能原因**:
- DeepSeek API 调用失败
- 后端错误

**查看后端日志**:
```bash
tail -f /tmp/lhi-backend.log
```

查找错误信息，如：
- `DeepSeek API call failed`
- `Failed to get AI analysis`

### 问题 3: 分享链接无法访问
**检查**:
1. 确认链接格式：`http://localhost:3001/share/{uuid}`
2. 检查 assessmentId 是否存在
3. 查看浏览器控制台是否有错误

---

## 🔍 验证 DeepSeek API

如果怀疑 API 有问题，运行测试脚本：

```bash
cd /Users/a1/Downloads/001/lhi-calculator/server
node test-deepseek.js
```

应该看到：
```
✅ Success!
📝 AI回复: [中文内容]
```

---

## 📊 服务器状态检查

### 检查服务运行状态
```bash
lsof -ti:3001  # 前端
lsof -ti:5001  # 后端
```

### 查看日志
```bash
# 前端日志
tail -f /tmp/lhi-frontend.log

# 后端日志
tail -f /tmp/lhi-backend.log
```

### 重启服务
```bash
# 停止所有服务
lsof -ti:3001 | xargs kill
lsof -ti:5001 | xargs kill

# 重启后端
cd /Users/a1/Downloads/001/lhi-calculator/server
npm run dev > /tmp/lhi-backend.log 2>&1 &

# 重启前端
cd /Users/a1/Downloads/001/lhi-calculator
npm run dev > /tmp/lhi-frontend.log 2>&1 &
```

---

## ✅ 预期结果对比

### 旧版本（无 AI）
- 只有分数和雷达图
- 没有详细分析文字
- 只有"重新测试"按钮

### 新版本（带 AI）
- ✅ 分数和雷达图
- ✅ 5 个维度的详细 AI 分析
- ✅ 不同颜色的卡片设计
- ✅ "重新测试"和"分享结果"两个按钮
- ✅ 提交时有加载动画
- ✅ 可以分享结果给朋友

---

## 📝 测试清单

- [ ] 能使用新测试码开始测评
- [ ] 提交时看到加载动画
- [ ] 加载动画持续 3-10 秒
- [ ] 报告页面显示分数
- [ ] 报告页面显示 5 个 AI 分析维度
- [ ] 每个分析维度都有内容（非空）
- [ ] 分析内容是中文
- [ ] 可以点击"分享结果"
- [ ] 分享弹窗正常显示
- [ ] 可以复制分享链接
- [ ] 分享链接能正常访问
- [ ] 分享页面显示简化版报告
- [ ] 分享页面的 CTA 能跳转到首页

---

## 🎨 UI/UX 验证

### 颜色方案
- 粉色 (#ec4899): 结果解释、主题色
- 绿色 (#10B981): 优势
- 橙色 (#F97316): 需要注意
- 蓝色 (#3B82F6): 个性化建议
- 紫色 (#A855F7): 专业建议

### 响应式设计
- [ ] 在桌面浏览器正常显示
- [ ] 在移动端（缩小窗口）正常显示
- [ ] 卡片布局自适应

### 动画效果
- [ ] 加载动画流畅
- [ ] 分享弹窗有缩放动画
- [ ] 按钮悬停有反馈

---

## 🚀 下一步优化建议

1. **性能优化**
   - 考虑在用户填写问卷时预热 API
   - 实现分析结果缓存

2. **用户体验**
   - 添加分析进度提示（"正在分析第 1/5 个维度..."）
   - 支持打印报告
   - 支持下载 PDF

3. **分享功能**
   - 生成分享海报图片
   - 支持二维码分享
   - 社交媒体分享按钮

4. **数据分析**
   - 管理后台查看 AI 分析历史
   - 分析质量评分
   - 用户反馈收集
